webpackJsonp([1],{"7zck":function(e,t){},Jolo:function(e,t){},NHnr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n("7+uW"),a=n("3EgV"),i=n.n(a),r=(n("7zck"),{name:"app",data:function(){return console.log("*"+window.pryvUsername+"*"),{username:this.$route.query.username,state2:"loading"}},computed:{state:function(){return this.state2}},created:function(){if(window.pryvUsername=this.$route.query.username||null,null!=window.pryvUsername){var e={settings:{auth:this.$route.query.auth,username:window.pryvUsername,serviceInfoUrl:this.$route.query.serviceInfoUrl}};window.pryvConnection=e,this.state2="ok",console.log("ok")}else console.error("username is not set")}}),o={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[null==e.username?n("div",[e._v("\n    Missing username or valid token\n  ")]):n("div",["loading"==e.state?n("div",[e._v("\n      Loading ...\n    ")]):n("div",["nok"==e.state?n("div",[e._v("\n        Failed\n      ")]):n("div",[e._v("\n        Audit for user: "+e._s(e.username)+"\n        "),n("router-link",{attrs:{to:"./"}},[e._v("Accesses")]),e._v(" "),n("router-view")],1)])])])},staticRenderFns:[]};var c=n("VU/8")(r,o,!1,function(e){n("Jolo")},null,null).exports,l=n("/ocq"),u=n("fTnx"),d=n.n(u),p=n("Xxa5"),f=n.n(p),y=n("exGp"),v=n.n(y),m={},h=n("GG98"),g=n("UZ5h");function k(e){return function(t){return"system"===t[e]?"System or Owner":m[t[e]]?m[t[e]].name:m[t[e]]}}var _,w=[{key:"lastUsed",title:"Last Usage",display:(_="lastUsed",function(e){return new Date(1e3*e[_]).toLocaleString()})},{key:"name",title:"Name",display:function(e){return function(t){return t[e]}}("name")},{key:"type",title:"Type",display:function(e){return"shared"===e.type?"Sharing":"app"===e.type?e.name.startsWith("cm-")?"Consent":"Device & App":"personal"==e.type?"Management tools":"Unknown"}},{key:"deleted",title:"Status",display:function(e){return null!=e.deleted?"Deleted":null!=e.expires&&new Date(1e3*e.expires)<new Date?"Expired":"Valid"}}],x=null,b={name:"Accesses",props:["onSelectProp"],data:function(){return{search:"",username:window.pryvUsername,UserInput:"",accesses:this.accesses,fields:w,pagination:{sortBy:"lastUsed",descending:!0,rowsPerPage:10},selected:[]}},computed:{},created:function(){var e=this;return v()(f.a.mark(function t(){var n,s,a,i,r,o,c,l;return f.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.connection=window.pryvConnection,n=e,s=e.connection.settings,a=s.auth,s.username,i=e.connection.settings.serviceInfoUrl,r=void 0,t.prev=7,t.next=10,h.get(i);case 10:r=t.sent,t.next=17;break;case 13:return t.prev=13,t.t0=t.catch(7),console.error(t.t0),t.abrupt("return");case 17:if(null!=(o=r.body.api)){t.next=21;break}return console.error("Can't get api url on "+i),t.abrupt("return");case 21:return o=o.replace("{username}",e.username),c=void 0,t.prev=23,t.next=26,h.get(g.resolve(o,"accesses")).query({includeExpired:!0,includeDeletions:!0}).set("Authorization",a);case 26:c=t.sent,t.next=33;break;case 29:return t.prev=29,t.t1=t.catch(23),console.log(t.t1),t.abrupt("return");case 33:l=c.body.accesses||[],null!=c.body.accessDeletions&&(l=l.concat(c.body.accessDeletions)),n.accesses=l,n.accesses.forEach(function(e){m[e.id]=e});case 37:case"end":return t.stop()}},t,e,[[7,13],[23,29]])}))()},methods:{filteredAccesses:function(){var e=this;return null!=this.search&&""!=this.search?this.accesses.filter(function(t){return t.id.includes(e.search)}):this.accesses},GoToRoute:function(){this.$router.push({name:"Paramdetails",params:{id:this.UserInput}})},changeSort:function(e){this.pagination.sortBy===e?this.pagination.descending=!this.pagination.descending:(this.pagination.sortBy=e,this.pagination.descending=!1)},onSelect:function(e){e!==x&&(e.createdByName=k("createdBy")(e),e.modifiedByName=k("modifiedBy")(e),x=e,this.onSelectProp&&this.onSelectProp(x),console.log("Accesses selected "+e.name+" > "+e.id))}}},S={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.fields,items:e.filteredAccesses(),pagination:e.pagination,"select-all":"","item-key":"id"},on:{"update:pagination":function(t){e.pagination=t}},scopedSlots:e._u([{key:"headers",fn:function(t){return[e._e(),e._v(" "),n("tr",e._l(t.headers,function(t){return n("th",{key:t.key,class:["column sortable",e.pagination.descending?"desc":"asc",t.name===e.pagination.sortBy?"active":""],on:{click:function(n){e.changeSort(t.key)}}},[n("v-icon",{attrs:{small:""}},[e._v("arrow_upward")]),e._v("\n        "+e._s(t.title)+"\n      ")],1)}))]}},{key:"items",fn:function(t){return[n("tr",{attrs:{active:t.selected},on:{click:function(n){e.onSelect(t.item)}}},e._l(e.fields,function(s){return n("td",{staticClass:"text-xs-left"},[e._v("\n        "+e._s(s.display(t.item))+"\n      ")])}))]}}]),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})},staticRenderFns:[]},U=n("VU/8")(b,S,!1,null,null,null).exports,D=n("EFqf"),A=n.n(D),L=n("GG98"),P=n.n(L),B=n("0rCA");function C(e){return function(t){return t[e]}}var E=[{key:"time",title:"Date",display:function(e){return new Date(1e3*e.time).toLocaleString()}},{key:"action",title:"Action",display:function(e){var t=e.action,n=t.substring(t.indexOf("/")+1),s=e.action.split(" ")[0],a=void 0;switch(s){case"GET":a="Retrieve";break;case"POST":a="Create";break;case"PUT":a="Modify";break;case"DELETE":a="Delete";break;default:a=s}return a+": "+n}},{key:"status",title:"Status",display:function(e){try{return B.getStatusText(e.status)}catch(t){return e.status}}}],I=[{title:"Action id",key:"actionId",display:C("id")},{title:"Timestamp",key:"timestamp",display:C("time")},{title:"Client IP",key:"clientIp",display:C("forwardedFor")},{title:"Action",key:"action",display:C("action")},{title:"Query",key:"query",display:C("query")},{title:"Access id",key:"accessId",display:C("accessId")},{title:"HTTP status",key:"httpStatus",display:function(e){return e.status}},{title:"Error message",key:"errorMsg",display:C("errorMessage")},{title:"Error id",key:"errorId",display:C("errorId")}],M=null,T={name:"auditLogs",properties:["onSelectProp"],props:{auditLogs:{type:Array,default:[]}},data:function(){return{username:window.pryvUsername,UserInput:"",fields:E,details:I,pagination:{sortBy:"time",descending:!0,rowsPerPage:9},selected:[]}},computed:{},created:function(){},methods:{changeSort:function(e){this.pagination.sortBy===e?this.pagination.descending=!this.pagination.descending:(this.pagination.sortBy=e,this.pagination.descending=!1)},onSelect:function(e){e!==M&&(M=e,this.onSelectProp&&this.onSelectProp(M),console.log("audit log selected "+e.id))}}},$={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.fields,items:e.auditLogs,pagination:e.pagination,"select-all":"","item-key":"id"},on:{"update:pagination":function(t){e.pagination=t}},scopedSlots:e._u([{key:"headers",fn:function(t){return[n("tr",e._l(t.headers,function(t){return n("th",{key:t.key,class:["column sortable",e.pagination.descending?"desc":"asc",t.name===e.pagination.sortBy?"active":""],on:{click:function(n){e.changeSort(t.key)}}},[n("v-icon",{attrs:{small:""}},[e._v("arrow_upward")]),e._v("\n        "+e._s(t.title)+"\n      ")],1)}))]}},{key:"items",fn:function(t){return[n("tr",{attrs:{active:t.selected},on:{click:function(n){t.expanded=!t.expanded,e.onSelect(t.item)}}},e._l(e.fields,function(s){return n("td",{staticClass:"text-xs-left"},[e._v("\n        "+e._s(s.display(t.item))+"\n      ")])}))]}},{key:"expand",fn:function(t){return[n("v-card",{attrs:{flat:""}},[n("v-card-text"),e._v(" "),e._l(e.details,function(s){return n("ul",[s.display(t.item)?n("li",{staticClass:"grey--text",staticStyle:{"white-space":"nowrap","text-align":"left"}},[n("B",[e._v(e._s(s.title))]),e._v(" â€” "),n("span",{domProps:{innerHTML:e._s(s.display(t.item))}})],1):e._e()])}),e._v(" "),n("v-card-text")],2)]}}]),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})},staticRenderFns:[]},q=n("VU/8")(T,$,!1,null,null,null).exports,R=n("UZ5h"),V=[{key:"permission",title:"Permissions",display:function(e){return"personal"===e.type?"System or Owner":e.permissions}},{key:"clientData",title:"Informations",display:function(e){if(e.clientData)return e.clientData["app-web-auth:description"]?A()(e.clientData["app-web-auth:description"].content):A()(e.clientData);return"-"}},{key:"created",title:"Creation Date",display:F("created")},{key:"createdBy",title:"Created By",display:z("createdByName")},{key:"modified",title:"Modification Date",display:function(e){return e.modified!==e.created?F("modified")(e):"-"}},{key:"modifiedBy",title:"Modified By",display:z("modifiedByName")},{key:"deleted",title:"Deleted",display:F("deleted")},{key:"expires",title:"Expires",display:F("expires")}];function F(e){return function(t){return null==t[e]?"-":new Date(1e3*t[e]).toLocaleString()}}function z(e){return function(t){return t[e]||"-"}}var G={name:"Data",props:[],components:{Audit:q},data:function(){return{auditLogs:[],auditLogsMap:{},access:this.selectedAccess,connection:this.connection,state:"loading",details:V,apiUrl:""}},computed:{},created:function(){var e=this;return v()(f.a.mark(function t(){var n,s;return f.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.access=null,e.connection=window.pryvConnection,e.state="ok",n=e.connection.settings.serviceInfoUrl,s=void 0,t.prev=5,t.next=8,P.a.get(n);case 8:s=t.sent,t.next=15;break;case 11:return t.prev=11,t.t0=t.catch(5),console.error(t.t0),t.abrupt("return");case 15:if(e.apiUrl=s.body.api,null!=e.apiUrl){t.next=19;break}return console.error("Can't get api url on "+n),t.abrupt("return");case 19:case"end":return t.stop()}},t,e,[[5,11]])}))()},methods:{selectAccess:function(){var e=v()(f.a.mark(function e(t){var n,s,a,i,r,o,c,l;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Data selected Access:"+t.name),this.access=t,null!=this.access&&null!=this.auditLogsMap){e.next=4;break}return e.abrupt("return",this.auditLogs=[]);case 4:if(null==this.auditLogsMap[t.id]){e.next=6;break}return e.abrupt("return",this.auditLogs=this.auditLogsMap[t.id]);case 6:if(this.state="loading",n=this,s=this.connection.settings,a=s.auth,i=s.username,null!=this.apiUrl){e.next=14;break}return console.error("apiUrl is not set"),e.abrupt("return");case 14:return r=this.apiUrl.replace("{username}",i),o=R.resolve(r,"/audit/logs"),c=void 0,e.prev=17,e.next=20,P.a.get(o).set("Authorization",a).query({accessId:t.id});case 20:c=e.sent,e.next=28;break;case 23:return e.prev=23,e.t0=e.catch(17),console.log(e.t0),n.state="nok",e.abrupt("return");case 28:l=c.body.auditLogs,n.auditLogsMap[t.id]=l,n.auditLogs=l,n.state="ok";case 32:case"end":return e.stop()}},e,this,[[17,23]])}));return function(t){return e.apply(this,arguments)}}()}},N={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"data"}},["loading"==e.state?n("div",[e._v("\n    Loading ...\n  ")]):n("div",["nok"==e.state?n("div",[e._v("\n      Failed\n    ")]):n("div",[e._v("\n      Details\n      "),e.access?n("div",[n("div",{staticClass:"headline"},[e._v(e._s(e.access.name))]),e._v(" "),e._l(e.details,function(t){return n("ul",["-"!==t.display(e.access)?n("li",{staticClass:"grey--text",staticStyle:{"white-space":"nowrap","text-align":"center"}},[n("B",[e._v(e._s(t.title))]),e._v(" â€” "),n("span",{domProps:{innerHTML:e._s(t.display(e.access))}})],1):e._e()])})],2):n("div",[n("H3",[e._v("-")])],1),e._v(" "),n("Audit",{attrs:{auditLogs:e.auditLogs}})],1)])])},staticRenderFns:[]},H=n("VU/8")(G,N,!1,null,null,null).exports,O={name:"main",components:{Accesses:U,splitPane:d.a,Data:H},methods:{onEventLoaded:function(){},onAccessSelect:function(e){console.log("*****",e),this.$refs.dataView.selectAccess(e)},resize:function(){console.log("resize")}}},J={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"mainView"}},[t("split-pane",{attrs:{"min-percent":50,"default-percent":50,split:"vertical"},on:{resize:this.resize}},[t("template",{slot:"paneL"},[t("Accesses",{attrs:{onSelectProp:this.onAccessSelect}})],1),this._v(" "),t("template",{slot:"paneR"},[t("Data",{ref:"dataView"})],1)],2)],1)},staticRenderFns:[]};var W=n("VU/8")(O,J,!1,function(e){n("cgRD")},null,null).exports;s.default.use(i.a),s.default.use(l.a);var Z=[{path:"/",component:W}],j=new l.a({base:window.location.pathname,routes:Z,mode:"hash"});window.v=new s.default({el:"#app",template:"<App/>",components:{App:c},router:j}).$mount("#app")},cgRD:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.2df5421ec629302a6be7.js.map